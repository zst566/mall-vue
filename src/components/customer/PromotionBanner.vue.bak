<template>
  <div class="banner-section">
    <van-swipe 
      v-if="mainImages && mainImages.length > 0" 
      :autoplay="3000" 
      indicator-color="white"
      class="banner-swipe"
    >
      <van-swipe-item v-for="(image, index) in mainImages" :key="index">
        <div 
          class="banner-image"
          :style="{
            '--banner-image-url': `url('${getImageUrl(image)}')`
          }"
        >
          <!-- 模糊背景层 -->
          <div class="banner-background-blur"></div>
          <!-- 主图片层 -->
          <div class="banner-image-main"></div>
        </div>
      </van-swipe-item>
    </van-swipe>
    <PlaceholderImage 
      v-else 
      width="100%" 
      height="400px" 
      class="banner-placeholder"
    />
  </div>
</template>

<script setup lang="ts">
import { computed, watch, onMounted } from 'vue'
import PlaceholderImage from '@/components/common/PlaceholderImage.vue'
import { usePromotionImages } from '@/composables/usePromotionImages'

interface Props {
  images: any[] | null
}

const props = defineProps<Props>()

// 使用 composable 处理图片
const imagesRef = computed(() => props.images)
const { mainImages, getImageUrl } = usePromotionImages(imagesRef)
</script>

<style lang="scss" scoped>
@use '@/styles/variables.scss' as *;
@use '@/styles/mixins.scss' as *;

// 顶部Banner主图区域
.banner-section {
  width: 100%;
  @include glassmorphism-card(light);

  .banner-swipe {
    width: 100%;
  }

  .banner-image {
    width: 100%;
    min-height: 300px;
    max-height: 500px;
    position: relative;
    display: flex;
    align-items: center;
    justify-content: center;
    overflow: hidden;
    background-color: #f5f5f5; // 默认背景色
    
    // 模糊背景层 - 填充整个容器
    .banner-background-blur {
      position: absolute;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background-image: var(--banner-image-url);
      background-size: cover; // 背景层使用cover填充整个容器
      background-position: center;
      background-repeat: no-repeat;
      filter: blur(20px);
      transform: scale(1.1) translateZ(0); // 稍微放大避免边缘模糊，启用GPU加速
      z-index: 0;
      will-change: transform, filter; // 提示浏览器优化transform和filter
      backface-visibility: hidden; // 优化渲染性能
      -webkit-backface-visibility: hidden; // Safari兼容
    }
    
    // 主图片层 - 完整显示图片
    .banner-image-main {
      position: relative;
      width: 100%;
      height: 100%;
      min-height: 300px;
      background-image: var(--banner-image-url);
      background-size: contain; // 使用contain，完整显示图片
      background-position: center;
      background-repeat: no-repeat;
      z-index: 1;
      will-change: transform; // 提示浏览器优化动画
      transform: translateZ(0); // 启用GPU加速
      backface-visibility: hidden; // 优化渲染性能
      -webkit-backface-visibility: hidden; // Safari兼容
    }
  }

  .banner-placeholder {
    width: 100%;
    height: 400px;
  }
}
</style>
